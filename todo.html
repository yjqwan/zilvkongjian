<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>积分制待办 - 学习版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        danger: '#EF4444',
                        dark: '#1F2937',
                        light: '#F3F4F6'
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .nav-shadow {
                box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            }
        }
    </style>
    <style>
        /* 保持原有CSS样式不变 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans SC', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --success: #4cc9f0;
            --warning: #fca311;
            --light: #f8f9fa;
            --dark: #2b2d42;
            --gray: #8d99ae;
            --light-gray: #edf2f4;
            --border: #e9ecef;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --gold: linear-gradient(135deg, #FFD700 0%, #DAA520 100%);
        }
        
        body {
            background: linear-gradient(135deg, #eef2f7 0%, #d9e4f5 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 40px;
            overflow-x: hidden;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 15px;
            gap: 20px;
        }
        
        /* 头部样式 */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 12px 20px;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .logo i {
            font-size: 1.8rem;
            color: #ffd43b;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .gold-display {
            background: rgba(0, 0, 0, 0.2);
            padding: 6px 15px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
            font-size: 1rem;
            min-width: auto;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .gold-display i {
            color: gold;
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
        }
        
        /* 主要内容区 */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* 左侧面板 - 待办事项 */
        .left-panel {
            width: 100%;
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
        }
        
        .panel-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
        }
        
        .panel-title h2 {
            font-size: 1.4rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 6px rgba(67, 97, 238, 0.3);
            font-size: 0.95rem;
        }
        
        .btn:hover {
            background: #3a56e4;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(67, 97, 238, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-success {
            background: var(--success);
            box-shadow: 0 4px 6px rgba(76, 201, 240, 0.3);
        }
        
        .btn-success:hover {
            background: #3bc0e8;
            box-shadow: 0 6px 8px rgba(76, 201, 240, 0.4);
        }
        
        .btn-warning {
            background: var(--warning);
            box-shadow: 0 4px 6px rgba(252, 163, 17, 0.3);
        }
        
        .btn-warning:hover {
            background: #e69500;
            box-shadow: 0 6px 8px rgba(252, 163, 17, 0.4);
        }
        
        .btn-accent {
            background: var(--accent);
            box-shadow: 0 4px 6px rgba(247, 37, 133, 0.3);
        }
        
        .btn-accent:hover {
            background: #e51e76;
            box-shadow: 0 6px 8px rgba(247, 37, 133, 0.4);
        }
        
        /* 待办事项列表 */
        .todos-container {
            flex: 1;
            overflow-y: auto;
            padding-right: 5px;
            max-height: 500px;
        }
        
        .major-todo {
            background: var(--light-gray);
            border-radius: 12px;
            padding: 12px 15px;
            margin-bottom: 10px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .major-todo:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }
        
        .major-todo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .major-title {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }
        
        .major-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        
        .minor-todos {
            margin-top: 12px;
            transition: all 0.3s ease;
        }
        
        .minor-todo {
            display: flex;
            align-items: center;
            background: white;
            padding: 10px 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
        }
        
        .minor-todo:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
        }
        
        .minor-todo input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--success);
        }
        
        .minor-title {
            flex: 1;
            font-size: 1rem;
        }
        
        .completed .minor-title {
            text-decoration: line-through;
            color: var(--gray);
        }
        
        .minor-actions {
            display: flex;
            gap: 6px;
        }
        
        .action-btn {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }
        
        .action-btn:hover {
            color: var(--primary);
            background: rgba(52, 152, 219, 0.1);
        }
        
        /* 折叠/展开相关样式 */
        .collapsible-content {
            transition: all 0.3s ease;
            overflow: hidden;
            max-height: 1000px;
        }
        
        .collapsed .collapsible-content {
            max-height: 0;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        
        .toggle-minor-btn {
            margin-left: 8px;
            color: var(--gray);
            flex-shrink: 0;
        }
        
        .toggle-minor-btn:hover {
            color: var(--primary);
            background: transparent;
        }
        
        /* 右侧面板 */
        .right-panel {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .rewards-section, .stats-section, .history-section {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow);
        }
        
        .history-content {
            max-height: 250px;
            overflow-y: auto;
            margin-top: 12px;
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.95rem;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-reward {
            font-weight: 600;
        }
        
        .history-details {
            color: var(--gray);
            font-size: 0.85rem;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        
        .rewards-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-top: 15px;
        }
        
        .reward-card {
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .reward-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }
        
        .reward-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .reward-title {
            font-weight: 600;
            font-size: 1.05rem;
        }
        
        .reward-cost {
            background: var(--gold);
            color: var(--dark);
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.85rem;
            min-width: 70px;
            text-align: center;
        }
        
        .reward-desc {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 15px;
        }
        
        .stat-card {
            background: var(--light-gray);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary);
            margin: 8px 0;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.85rem;
        }
        
        /* 添加表单 */
        .add-form {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-top: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        .form-buttons {
            display: flex;
            gap: 8px;
        }
        
        /* 通知 */
        .notification {
            position: fixed;
            top: 15px;
            right: 15px;
            padding: 12px 20px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            max-width: 90%;
            font-size: 0.95rem;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-left: 4px solid var(--success);
        }
        
        .notification.error {
            border-left: 4px solid var(--accent);
        }
        
        .notification.warning {
            border-left: 4px solid var(--warning);
        }
        
        /* 模态窗口 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background: white;
            border-radius: 16px;
            padding: 25px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.active .modal {
            transform: translateY(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }
        
        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            transition: color 0.3s;
        }
        
        .modal-close:hover {
            color: var(--accent);
        }
        
        .import-format {
            background: var(--light-gray);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .import-format h4 {
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .import-format pre {
            background: white;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        /* 移动端适配 */
        @media (min-width: 768px) {
            .container {
                padding: 0 20px;
            }
            
            .main-content {
                flex-direction: row;
            }
            
            .left-panel {
                flex: 1;
                min-width: 300px;
            }
            
            .right-panel {
                width: 350px;
                min-width: 300px;
            }
            
            .header-content {
                flex-direction: row;
                text-align: left;
            }
            
            .major-actions {
                width: auto;
                justify-content: flex-end;
            }
            
            .rewards-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (min-width: 992px) {
            .rewards-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* 动画效果 */
        @keyframes coinAnimation {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .coin-effect {
            position: absolute;
            color: gold;
            font-size: 1.5rem;
            animation: coinAnimation 1s forwards;
            z-index: 50;
        }
        
        /* 完成效果 */
        @keyframes completeAnimation {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0); opacity: 0; }
        }
        
        .completing {
            animation: completeAnimation 0.5s forwards;
        }
        
        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: 20px;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 10px;
            opacity: 0.5;
        }
        
        /* 庆祝动画 */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #f00;
            top: 0;
            left: 0;
            opacity: 0;
            pointer-events: none;
            z-index: 1000;
        }
        
        @keyframes confetti-fall {
            0% { transform: translateY(0) rotate(0); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        
        @keyframes confetti-side {
            0% { transform: translateY(0) translateX(0) rotate(0); opacity: 1; }
            100% { transform: translateY(50vh) translateX(100px) rotate(360deg); opacity: 0; }
        }
        
        @keyframes fireworks {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(1); opacity: 0; }
        }
        
        .firework {
            position: fixed;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1000;
        }
        
        .celebration-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 30px;
            border-radius: 16px;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 2000;
            text-align: center;
        }
        
        .celebration-message.show {
            animation: celebration-popup 1.5s forwards;
        }
        
        @keyframes celebration-popup {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            70% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
        }
        
        /* 移动端优化类 */
        .mobile-flex {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .mobile-btn-text {
            display: none;
        }
        
        @media (max-width: 480px) {
            .btn {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            
            .btn i {
                margin-right: 0;
            }
            
            .mobile-btn-text {
                display: inline;
            }
            
            .desktop-btn-text {
                display: none;
            }
            
            .gold-display {
                padding: 6px 12px;
                font-size: 0.9rem;
            }
            
            .major-actions .btn {
                flex: 1;
                text-align: center;
                justify-content: center;
            }
            
            .form-buttons {
                flex-direction: column;
            }
        }
    
        /* 导航栏阴影 */
        .nav-shadow {
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body>
    <!-- 通知区域 -->
    <div id="notification-area"></div>
    
    <!-- 批量导入模态窗口 -->
    <div class="modal-overlay" id="import-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fa fa-upload"></i> 批量导入待办事项</h3>
                <button class="modal-close" id="close-import-modal">&times;</button>
            </div>
            
            <div class="import-format">
                <h4>格式说明：</h4>
                <p>每行输入一个待办事项，使用缩进表示层级关系：</p>
                <ul>
                    <li>大目标：直接输入文本</li>
                    <li>小目标：在文本前添加2个空格或1个Tab缩进</li>
                </ul>
                <p>示例：</p>
                <pre>期末考试考全班第一
  做1000篇语文阅读理解
  学完初中数学
学习英语
  背诵500个单词
  完成30篇英语阅读</pre>
            </div>
            
            <div class="form-group">
                <label for="batch-input">待办事项列表</label>
                <textarea class="form-control" id="batch-input" rows="10" placeholder="请输入待办事项，每行一个..."></textarea>
            </div>
            
            <div class="form-buttons">
                <button class="btn btn-success" id="confirm-import">
                    <i class="fa fa-check"></i> 导入
                </button>
                <button class="btn btn-accent" id="cancel-import">
                    <i class="fa fa-times"></i> 取消
                </button>
            </div>
        </div>
    </div>
    
    <!-- 自定义奖励模态窗口 -->
    <div class="modal-overlay" id="custom-reward-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fa fa-plus-circle"></i> 添加自定义奖励</h3>
                <button class="modal-close" id="close-custom-reward-modal">&times;</button>
            </div>
            
            <div class="form-group">
                <label for="custom-reward-name">奖励名称</label>
                <input type="text" class="form-control" id="custom-reward-name" placeholder="例如：玩游戏1小时">
            </div>
            
            <div class="form-group">
                <label for="custom-reward-desc">奖励描述</label>
                <textarea class="form-control" id="custom-reward-desc" rows="3" placeholder="描述这个奖励的具体内容..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="custom-reward-cost">所需金币</label>
                <input type="number" class="form-control" id="custom-reward-cost" placeholder="输入所需的金币数量" min="10">
            </div>
            
            <div class="form-buttons">
                <button class="btn btn-success" id="confirm-add-reward">
                    <i class="fa fa-check"></i> 添加
                </button>
                <button class="btn btn-accent" id="cancel-add-reward">
                    <i class="fa fa-times"></i> 取消
                </button>
            </div>
        </div>
    </div>
    
    <!-- 页面头部 -->
    <header>
        <div class="header-content">
            <div class="logo">
                <i class="fa fa-crown"></i>
                <span>积分制待办 - 学习版</span>
            </div>
            <div class="user-info">
                <div class="gold-display">
                    <i class="fa fa-coins"></i>
                    <span id="gold-amount">100</span> 金币
                </div>
                <div class="user">
                    <i class="fa fa-user-circle"></i> <span id="username">学习者</span>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="main-content">
            <!-- 左侧面板：待办事项 -->
            <div class="left-panel">
                <div class="panel-title">
                    <h2><i class="fa fa-tasks"></i> 待办管理</h2>
                    <div>
                        <button class="btn" id="add-major-btn">
                            <i class="fa fa-plus"></i>
                            <span class="desktop-btn-text">添加大目标</span>
                            <span class="mobile-btn-text">添加</span>
                        </button>
                        <button class="btn btn-accent" id="batch-import-btn">
                            <i class="fa fa-upload"></i>
                            <span class="desktop-btn-text">批量导入</span>
                            <span class="mobile-btn-text">导入</span>
                        </button>
                    </div>
                </div>
                
                <div class="todos-container" id="todos-container">
                    <!-- 示例待办事项 -->
                    <div class="major-todo">
                        <div class="major-todo-header">
                            <div class="major-title">
                                <i class="fa fa-graduation-cap"></i>
                                <span>期末考试考全班第一</span>
                                <button class="action-btn toggle-minor-btn" data-id="1">
                                    <i class="fa fa-chevron-up"></i>
                                </button>
                            </div>
                        </div>
                        <div class="collapsible-content">
                            <div class="major-actions mobile-flex">
                                <button class="btn" disabled style="opacity: 0.5;">
                                    <i class="fa fa-check"></i>
                                    <span class="desktop-btn-text">完成大目标</span>
                                    <span class="mobile-btn-text">完成</span>
                                </button>
                                <button class="btn add-minor-btn" data-id="1">
                                    <i class="fa fa-plus"></i>
                                    <span class="desktop-btn-text">添加小目标</span>
                                    <span class="mobile-btn-text">添加任务</span>
                                </button>
                            </div>
                            <div class="minor-todos" id="minor-todos-1">
                                <div class="minor-todo" data-id="101">
                                    <input type="checkbox" data-id="101">
                                    <div class="minor-title">做1000篇语文阅读理解</div>
                                    <div class="minor-actions">
                                        <button class="action-btn delete-minor-btn" data-id="101">
                                            <i class="fa fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="minor-todo" data-id="102">
                                    <input type="checkbox" data-id="102">
                                    <div class="minor-title">学完初中数学</div>
                                    <div class="minor-actions">
                                        <button class="action-btn delete-minor-btn" data-id="102">
                                            <i class="fa fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 添加目标表单 -->
                <div class="add-form" id="add-form">
                    <div class="form-group">
                        <label for="goal-type">添加目标类型</label>
                        <select class="form-control" id="goal-type">
                            <option value="major">大目标</option>
                            <option value="minor">小目标</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="goal-title">目标标题</label>
                        <input type="text" class="form-control" id="goal-title" placeholder="输入目标内容...">
                    </div>
                    
                    <div class="form-group" id="parent-goal-group" style="display: none;">
                        <label for="parent-goal">所属大目标</label>
                        <select class="form-control" id="parent-goal">
                            <!-- 由JavaScript动态填充 -->
                        </select>
                    </div>
                    
                    <div class="form-buttons">
                        <button class="btn" id="add-goal-btn" style="flex: 1;">
                            <i class="fa fa-plus"></i> 添加目标
                        </button>
                        <button class="btn btn-accent" id="cancel-add-btn" style="flex: 1;">
                            <i class="fa fa-times"></i> 取消
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 右侧面板：金币系统 -->
            <div class="right-panel">
                <!-- 统计和进度 -->
                <div class="stats-section">
                    <div class="panel-title">
                        <h2><i class="fa fa-chart-line"></i> 学习统计</h2>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <i class="fa fa-bullseye fa-2x"></i>
                            <div class="stat-value" id="completed-minor">0</div>
                            <div class="stat-label">已完成小目标</div>
                        </div>
                        
                        <div class="stat-card">
                            <i class="fa fa-hourglass-half fa-2x"></i>
                            <div class="stat-value" id="pending-minor">2</div>
                            <div class="stat-label">进行中小目标</div>
                        </div>
                        
                        <div class="stat-card">
                            <i class="fa fa-fire fa-2x"></i>
                            <div class="stat-value" id="streak-days">1</div>
                            <div class="stat-label">连续学习天数</div>
                        </div>
                        
                        <div class="stat-card">
                            <i class="fa fa-trophy fa-2x"></i>
                            <div class="stat-value" id="completed-major">0</div>
                            <div class="stat-label">已完成大目标</div>
                        </div>
                    </div>
                </div>
                
                <!-- 奖励兑换区 -->
                <div class="rewards-section">
                    <div class="panel-title">
                        <h2><i class="fa fa-gift"></i> 奖励兑换</h2>
                        <button class="btn btn-accent" id="add-custom-reward-btn">
                            <i class="fa fa-plus"></i> 添加奖励
                        </button>
                    </div>
                    
                    <div class="rewards-grid">
                        <div class="reward-card">
                            <div class="reward-header">
                                <div class="reward-title">放松时刻</div>
                                <div class="reward-cost">500 金币</div>
                            </div>
                            <div class="reward-desc">
                                兑换后可以刷15分钟视频
                            </div>
                            <button class="btn btn-warning reward-btn" data-cost="500" data-reward="放松时刻">
                                <i class="fa fa-shopping-cart"></i> 立即兑换
                            </button>
                        </div>
                        
                        <div class="reward-card">
                            <div class="reward-header">
                                <div class="reward-title">美味奶茶</div>
                                <div class="reward-cost">1000 金币</div>
                            </div>
                            <div class="reward-desc">
                                奖励自己一杯喜欢的奶茶
                            </div>
                            <button class="btn btn-warning reward-btn" data-cost="1000" data-reward="美味奶茶">
                                <i class="fa fa-shopping-cart"></i> 立即兑换
                            </button>
                        </div>
                        
                        <div class="reward-card">
                            <div class="reward-header">
                                <div class="reward-title">心仪礼物</div>
                                <div class="reward-cost">3000 金币</div>
                            </div>
                            <div class="reward-desc">
                                兑换最想要的一件物品
                            </div>
                            <button class="btn btn-warning reward-btn" data-cost="3000" data-reward="心仪礼物">
                                <i class="fa fa-shopping-cart"></i> 立即兑换
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 兑换记录区 -->
                <div class="history-section">
                    <div class="panel-title">
                        <h2><i class="fa fa-history"></i> 兑换记录</h2>
                    </div>
                    
                    <div class="history-content" id="history-content">
                        <div class="empty-state">
                            <i class="fa fa-history"></i>
                            <p>暂无兑换记录</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 数据结构
        let userData = {
            gold: 100,
            completedMinor: 0,
            completedMajor: 0,
            streak: 1,
            lastLogin: new Date().toISOString()
        };
        
        let goals = [
            {
                id: 1,
                title: "期末考试考全班第一",
                completed: false,
                collapsed: false,
                minorTodos: [
                    { id: 101, title: "做1000篇语文阅读理解", completed: false },
                    { id: 102, title: "学完初中数学", completed: false }
                ]
            }
        ];
        
        // 自定义奖励数组
        let customRewards = [];
        
        // 兑换记录
        let redemptionHistory = [];
        
        // DOM 元素
        const todosContainer = document.getElementById('todos-container');
        const goldAmountElement = document.getElementById('gold-amount');
        const goalTypeSelect = document.getElementById('goal-type');
        const parentGoalGroup = document.getElementById('parent-goal-group');
        const parentGoalSelect = document.getElementById('parent-goal');
        const goalTitleInput = document.getElementById('goal-title');
        const addGoalBtn = document.getElementById('add-goal-btn');
        const cancelAddBtn = document.getElementById('cancel-add-btn');
        const addMajorBtn = document.getElementById('add-major-btn');
        const batchImportBtn = document.getElementById('batch-import-btn');
        const rewardButtons = document.querySelectorAll('.reward-btn');
        const notificationArea = document.getElementById('notification-area');
        const historyContent = document.getElementById('history-content');
        const importModal = document.getElementById('import-modal');
        const closeImportModal = document.getElementById('close-import-modal');
        const cancelImport = document.getElementById('cancel-import');
        const confirmImport = document.getElementById('confirm-import');
        const batchInput = document.getElementById('batch-input');
        const addCustomRewardBtn = document.getElementById('add-custom-reward-btn');
        const customRewardModal = document.getElementById('custom-reward-modal');
        const closeCustomRewardModal = document.getElementById('close-custom-reward-modal');
        const cancelAddReward = document.getElementById('cancel-add-reward');
        const confirmAddReward = document.getElementById('confirm-add-reward');
        const customRewardNameInput = document.getElementById('custom-reward-name');
        const customRewardDescInput = document.getElementById('custom-reward-desc');
        const customRewardCostInput = document.getElementById('custom-reward-cost');
        const rewardsGrid = document.querySelector('.rewards-grid');
        
        // 统计元素
        const completedMinorElement = document.getElementById('completed-minor');
        const pendingMinorElement = document.getElementById('pending-minor');
        const streakDaysElement = document.getElementById('streak-days');
        const completedMajorElement = document.getElementById('completed-major');
        
        // 初始化 - 从localStorage加载数据
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            renderGoals();
            renderCustomRewards(); // 渲染自定义奖励
            updateStats();
            updateGoldDisplay();
            renderRedemptionHistory();
            setupEventDelegation(); // 使用事件委托代替直接绑定
            
            // 检查连续登录
            checkStreak();
            
            // 保存数据
            saveData();
            
            // 设置批量导入模态窗口事件
            setupImportModalEvents();
            
            // 设置自定义奖励模态窗口事件
            setupCustomRewardModalEvents();
        });
        
        // 设置批量导入模态窗口事件
        function setupImportModalEvents() {
            // 打开批量导入模态窗口
            batchImportBtn.addEventListener('click', () => {
                importModal.classList.add('active');
                batchInput.value = '';
                batchInput.focus();
            });
            
            // 关闭批量导入模态窗口
            closeImportModal.addEventListener('click', () => {
                importModal.classList.remove('active');
            });
            
            // 取消导入
            cancelImport.addEventListener('click', () => {
                importModal.classList.remove('active');
            });
            
            // 确认导入
            confirmImport.addEventListener('click', () => {
                const text = batchInput.value.trim();
                if (!text) {
                    showNotification('请输入待办事项', 'error');
                    return;
                }
                
                const result = parseBatchInput(text);
                if (result.majorGoalsCount === 0 && result.minorTodosCount === 0) {
                    showNotification('没有解析到有效的待办事项', 'error');
                    return;
                }
                
                // 添加解析后的目标
                goals = goals.concat(result.goals);
                
                // 更新界面
                renderGoals();
                updateStats();
                saveData();
                
                // 显示成功消息
                showNotification(`成功导入${result.majorGoalsCount}个大目标和${result.minorTodosCount}个小目标`, 'success');
                
                // 关闭模态窗口
                importModal.classList.remove('active');
            });
            
            // 点击模态窗口外部关闭
            importModal.addEventListener('click', (e) => {
                if (e.target === importModal) {
                    importModal.classList.remove('active');
                }
            });
        }
        
        // 解析批量输入的文本
        function parseBatchInput(text) {
            const lines = text.split('\n');
            const newGoals = [];
            let currentGoal = null;
            let majorGoalsCount = 0;
            let minorTodosCount = 0;
            
            for (let line of lines) {
                // 跳过空行
                if (!line.trim()) continue;
                
                // 检测缩进级别
                const indentMatch = line.match(/^(\s+)/);
                const indentLevel = indentMatch ? indentMatch[1].length : 0;
                
                // 如果是小目标（有缩进）
                if (indentLevel > 0 && currentGoal) {
                    const title = line.trim();
                    if (title) {
                        currentGoal.minorTodos.push({
                            id: generateUniqueId(),
                            title: title,
                            completed: false
                        });
                        minorTodosCount++;
                    }
                } 
                // 如果是大目标（无缩进）
                else {
                    const title = line.trim();
                    if (title) {
                        currentGoal = {
                            id: generateUniqueId(),
                            title: title,
                            completed: false,
                            collapsed: false,
                            minorTodos: []
                        };
                        newGoals.push(currentGoal);
                        majorGoalsCount++;
                    }
                }
            }
            
            return {
                goals: newGoals,
                majorGoalsCount: majorGoalsCount,
                minorTodosCount: minorTodosCount
            };
        }
        
        // 生成唯一ID的函数 - 修复潜在的ID冲突问题
        function generateUniqueId() {
            return Date.now() + Math.floor(Math.random() * 1000);
        }
        
        // 保存数据到localStorage
        function saveData() {
            const data = {
                userData: userData,
                goals: goals,
                redemptionHistory: redemptionHistory,
                customRewards: customRewards
            };
            localStorage.setItem('studyGameData', JSON.stringify(data));
        }
        
        // 从localStorage加载数据
        function loadData() {
            const savedData = localStorage.getItem('studyGameData');
            if (savedData) {
                const data = JSON.parse(savedData);
                userData = data.userData || userData;
                goals = data.goals || goals;
                redemptionHistory = data.redemptionHistory || redemptionHistory;
                customRewards = data.customRewards || [];
            }
        }
        
        // 使用事件委托设置事件监听器 - 修复多元素时的事件绑定问题
        function setupEventDelegation() {
            // 为整个待办容器添加一个事件监听器，而不是为每个元素单独添加
            todosContainer.addEventListener('click', function(e) {
                // 折叠/展开按钮
                if (e.target.closest('.toggle-minor-btn')) {
                    const btn = e.target.closest('.toggle-minor-btn');
                    const goalId = parseInt(btn.dataset.id);
                    toggleGoalCollapse(goalId);
                    return;
                }
                
                // 添加小目标按钮
                if (e.target.closest('.add-minor-btn')) {
                    const btn = e.target.closest('.add-minor-btn');
                    const goalId = parseInt(btn.dataset.id);
                    goalTypeSelect.value = 'minor';
                    parentGoalGroup.style.display = 'block';
                    populateParentGoals();
                    parentGoalSelect.value = goalId;
                    goalTitleInput.focus();
                    return;
                }
                
                // 完成大目标按钮
                if (e.target.closest('.complete-major-btn')) {
                    const btn = e.target.closest('.complete-major-btn');
                    const goalId = parseInt(btn.dataset.id);
                    completeMajorGoal(goalId);
                    saveData();
                    return;
                }
                
                // 删除小目标按钮
                if (e.target.closest('.delete-minor-btn')) {
                    const btn = e.target.closest('.delete-minor-btn');
                    const todoId = parseInt(btn.dataset.id);
                    deleteMinorTodo(todoId);
                    saveData();
                    return;
                }
            });
            
            // 小目标复选框事件委托
            todosContainer.addEventListener('change', function(e) {
                if (e.target.matches('.minor-todos input[type="checkbox"]')) {
                    const todoId = parseInt(e.target.dataset.id);
                    toggleMinorTodo(todoId, e.target.checked);
                    saveData();
                }
            });
            
            // 目标类型切换
            goalTypeSelect.addEventListener('change', () => {
                if (goalTypeSelect.value === 'minor') {
                    parentGoalGroup.style.display = 'block';
                    populateParentGoals();
                } else {
                    parentGoalGroup.style.display = 'none';
                }
            });
            
            // 添加目标
            addGoalBtn.addEventListener('click', () => {
                addGoal();
                saveData();
            });
            
            // 取消添加
            cancelAddBtn.addEventListener('click', () => {
                goalTitleInput.value = '';
                parentGoalGroup.style.display = 'none';
                goalTypeSelect.value = 'major';
            });
            
            // 添加大目标按钮
            addMajorBtn.addEventListener('click', () => {
                goalTypeSelect.value = 'major';
                parentGoalGroup.style.display = 'none';
                goalTitleInput.value = '';
                goalTitleInput.focus();
            });
            
            // 奖励兑换
            rewardButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const cost = parseInt(btn.dataset.cost);
                    const reward = btn.dataset.reward;
                    redeemReward(cost, reward);
                    saveData();
                });
            });
        }
        
        // 切换目标折叠状态
        function toggleGoalCollapse(goalId) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;
            
            // 切换折叠状态
            goal.collapsed = !goal.collapsed;
            
            // 更新UI
            const goalElement = document.querySelector(`.major-todo[data-id="${goalId}"]`);
            if (goalElement) {
                if (goal.collapsed) {
                    goalElement.classList.add('collapsed');
                } else {
                    goalElement.classList.remove('collapsed');
                }
                
                // 更新按钮图标
                const iconElement = goalElement.querySelector('.toggle-minor-btn i');
                if (iconElement) {
                    iconElement.className = `fa ${goal.collapsed ? 'fa-chevron-down' : 'fa-chevron-up'}`;
                }
            }
            
            // 保存状态
            saveData();
        }
        
        // 渲染兑换记录
        function renderRedemptionHistory() {
            if (redemptionHistory.length === 0) {
                historyContent.innerHTML = `
                    <div class="empty-state">
                        <i class="fa fa-history"></i>
                        <p>暂无兑换记录</p>
                    </div>
                `;
                return;
            }
            
            let historyHTML = '';
            
            // 按日期降序排列
            redemptionHistory.sort((a, b) => new Date(b.date) - new Date(a.date))
                .forEach(item => {
                historyHTML += `
                    <div class="history-item">
                        <div class="history-reward">${item.reward}</div>
                        <div class="history-details">
                            <div>-${item.cost} 金币</div>
                            <div>${item.date}</div>
                        </div>
                    </div>
                `;
            });
            
            historyContent.innerHTML = historyHTML;
        }
        
        // 渲染目标列表
        function renderGoals() {
            todosContainer.innerHTML = '';
            
            if (goals.length === 0) {
                todosContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fa fa-tasks"></i>
                        <h3>暂无学习目标</h3>
                        <p>点击"添加大目标"按钮开始你的学习之旅</p>
                    </div>
                `;
                return;
            }
            
            goals.forEach(goal => {
                const goalElement = document.createElement('div');
                goalElement.className = `major-todo ${goal.collapsed ? 'collapsed' : ''}`;
                goalElement.dataset.id = goal.id;
                
                // 检查是否所有子任务已完成
                const allCompleted = goal.minorTodos.every(todo => todo.completed);
                
                // 折叠/展开按钮图标
                const toggleIcon = goal.collapsed ? 'fa-chevron-down' : 'fa-chevron-up';
                
                let goalHTML = `
                    <div class="major-todo-header">
                        <div class="major-title">
                            <i class="fa fa-graduation-cap"></i>
                            <span>${goal.title}</span>
                            <button class="action-btn toggle-minor-btn" data-id="${goal.id}">
                                <i class="fa ${toggleIcon}"></i>
                            </button>
                        </div>
                    </div>
                    <div class="collapsible-content">
                        <div class="major-actions mobile-flex">
                            ${allCompleted ? 
                                `<button class="btn btn-success complete-major-btn" data-id="${goal.id}">
                                    <i class="fa fa-check"></i>
                                    <span class="desktop-btn-text">完成大目标</span>
                                    <span class="mobile-btn-text">完成</span>
                                </button>` : 
                                `<button class="btn" disabled style="opacity: 0.5;">
                                    <i class="fa fa-check"></i>
                                    <span class="desktop-btn-text">完成大目标</span>
                                    <span class="mobile-btn-text">完成</span>
                                </button>`
                            }
                            <button class="btn add-minor-btn" data-id="${goal.id}">
                                <i class="fa fa-plus"></i>
                                <span class="desktop-btn-text">添加小目标</span>
                                <span class="mobile-btn-text">添加任务</span>
                            </button>
                        </div>
                        <div class="minor-todos" id="minor-todos-${goal.id}">
                `;
                
                goal.minorTodos.forEach(todo => {
                    goalHTML += `
                        <div class="minor-todo ${todo.completed ? 'completed' : ''}" data-id="${todo.id}">
                            <input type="checkbox" ${todo.completed ? 'checked' : ''} data-id="${todo.id}">
                            <div class="minor-title">${todo.title}</div>
                            <div class="minor-actions">
                                <button class="action-btn delete-minor-btn" data-id="${todo.id}">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                goalHTML += `</div></div>`;
                goalElement.innerHTML = goalHTML;
                todosContainer.appendChild(goalElement);
            });
        }
        
        // 切换小目标完成状态
        function toggleMinorTodo(id, completed) {
            let found = false;
            
            goals.forEach(goal => {
                goal.minorTodos.forEach(todo => {
                    if (todo.id === id) {
                        todo.completed = completed;
                        found = true;
                        
                        if (completed) {
                            // 增加金币
                            addGold(10);
                            showNotification(`+10 金币！完成了一个小目标`, 'success');
                            userData.completedMinor++;
                            
                            // 创建金币动画效果
                            createCoinEffect();
                        } else {
                            // 如果取消完成，扣除金币
                            if (userData.gold >= 10) {
                                userData.gold -= 10;
                                userData.completedMinor--;
                                updateGoldDisplay();
                            }
                        }
                    }
                });
            });
            
            if (found) {
                renderGoals();
                updateStats();
            }
        }
        
        // 完成大目标
        function completeMajorGoal(id) {
            const goal = goals.find(g => g.id === id);
            
            if (goal && !goal.completed) {
                // 检查是否所有小目标都已完成
                const allCompleted = goal.minorTodos.every(todo => todo.completed);
                
                if (allCompleted) {
                    // 创建庆祝动画
                    createCelebration();
                    
                    // 显示庆祝消息
                    showCelebrationMessage(`恭喜完成大目标！`);
                    
                    // 标记为完成中（用于动画）
                    const goalElement = document.querySelector(`.major-todo[data-id="${id}"]`);
                    goalElement.classList.add('completing');
                    
                    setTimeout(() => {
                        // 从数组中移除该目标
                        const goalIndex = goals.findIndex(g => g.id === id);
                        if (goalIndex !== -1) {
                            goals.splice(goalIndex, 1);
                        }
                        
                        // 增加金币
                        addGold(100);
                        showNotification(`+100 金币！成功完成了一个大目标`, 'success');
                        userData.completedMajor++;
                        
                        // 创建金币动画效果
                        createCoinEffect();
                        
                        renderGoals();
                        updateStats();
                    }, 1000);
                } else {
                    showNotification(`请先完成所有小目标！`, 'error');
                }
            }
        }
        
        // 添加金币
        function addGold(amount) {
            userData.gold += amount;
            updateGoldDisplay();
        }
        
        // 更新金币显示
        function updateGoldDisplay() {
            goldAmountElement.textContent = userData.gold;
        }
        
        // 兑换奖励
        function redeemReward(cost, reward) {
            if (userData.gold >= cost) {
                userData.gold -= cost;
                updateGoldDisplay();
                
                // 添加兑换记录
                const now = new Date();
                const dateStr = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
                
                redemptionHistory.unshift({
                    id: generateUniqueId(),
                    reward: reward,
                    cost: cost,
                    date: dateStr
                });
                
                // 更新兑换记录显示
                renderRedemptionHistory();
                
                showNotification(`兑换成功！已使用 ${cost} 金币兑换 ${reward}`, 'success');
            } else {
                showNotification(`金币不足！还需要 ${cost - userData.gold} 金币`, 'error');
            }
        }
        
        // 添加目标
        function addGoal() {
            const title = goalTitleInput.value.trim();
            const type = goalTypeSelect.value;
            
            if (!title) {
                showNotification('请输入目标标题', 'error');
                return;
            }
            
            if (type === 'major') {
                // 添加大目标，使用更可靠的ID生成方式
                const newGoal = {
                    id: generateUniqueId(),
                    title: title,
                    completed: false,
                    collapsed: false,
                    minorTodos: []
                };
                
                goals.push(newGoal);
                showNotification(`已添加大目标: ${title}`, 'success');
            } else {
                // 添加小目标
                const parentId = parseInt(parentGoalSelect.value);
                const parentGoal = goals.find(g => g.id === parentId);
                
                if (parentGoal) {
                    parentGoal.minorTodos.push({
                        id: generateUniqueId(),
                        title: title,
                        completed: false
                    });
                    
                    showNotification(`已添加小目标: ${title}`, 'success');
                }
            }
            
            // 重置表单
            goalTitleInput.value = '';
            parentGoalGroup.style.display = 'none';
            goalTypeSelect.value = 'major';
            
            // 重新渲染
            renderGoals();
            updateStats();
        }
        
        // 删除小目标
        function deleteMinorTodo(id) {
            let found = false;
            
            goals.forEach(goal => {
                const index = goal.minorTodos.findIndex(todo => todo.id === id);
                if (index !== -1) {
                    goal.minorTodos.splice(index, 1);
                    found = true;
                    showNotification('已删除小目标', 'success');
                }
            });
            
            if (found) {
                renderGoals();
                updateStats();
            }
        }
        
        // 填充父目标选择
        function populateParentGoals() {
            parentGoalSelect.innerHTML = '';
            
            goals.forEach(goal => {
                const option = document.createElement('option');
                option.value = goal.id;
                option.textContent = goal.title;
                parentGoalSelect.appendChild(option);
            });
        }
        
        // 更新统计数据
        function updateStats() {
            let completedMinor = 0;
            let pendingMinor = 0;
            let completedMajor = userData.completedMajor;
            
            goals.forEach(goal => {
                goal.minorTodos.forEach(todo => {
                    if (todo.completed) completedMinor++;
                    else pendingMinor++;
                });
            });
            
            completedMinorElement.textContent = completedMinor;
            pendingMinorElement.textContent = pendingMinor;
            completedMajorElement.textContent = completedMajor;
            streakDaysElement.textContent = userData.streak;
        }
        
        // 检查连续登录
        function checkStreak() {
            const today = new Date().toDateString();
            
            if (!userData.lastLogin) {
                // 第一次登录
                userData.streak = 1;
            } else {
                const lastLogin = new Date(userData.lastLogin);
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (lastLogin.toDateString() === yesterday.toDateString()) {
                    // 连续登录
                    userData.streak++;
                } else if (lastLogin.toDateString() !== today) {
                    // 登录中断
                    userData.streak = 1;
                }
            }
            
            userData.lastLogin = new Date().toISOString();
            streakDaysElement.textContent = userData.streak;
            
            if (userData.streak > 1) {
                showNotification(`连续学习${userData.streak}天！继续加油！`, 'success');
            }
        }
        
        // 显示通知
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fa fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            notificationArea.appendChild(notification);
            
            // 显示通知
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // 3秒后移除
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }
        
        // 创建金币动画效果
        function createCoinEffect() {
            const coin = document.createElement('div');
            coin.className = 'coin-effect';
            coin.innerHTML = '<i class="fa fa-coins"></i>';
            
            // 随机位置
            const x = Math.random() * window.innerWidth;
            coin.style.left = `${x}px`;
            coin.style.top = '20px';
            
            document.body.appendChild(coin);
            
            // 动画结束后移除
            setTimeout(() => {
                coin.remove();
            }, 1000);
        }
        
        // 创建庆祝动画
        function createCelebration() {
            // 创建彩带效果
            for (let i = 0; i < 150; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                
                // 随机颜色
                const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                // 随机位置
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.top = '0';
                
                // 随机大小
                const size = Math.random() * 10 + 5;
                confetti.style.width = `${size}px`;
                confetti.style.height = `${size}px`;
                
                // 随机动画
                const animation = Math.random() > 0.5 ? 'confetti-fall' : 'confetti-side';
                confetti.style.animation = `${animation} ${Math.random() * 3 + 2}s linear forwards`;
                
                document.body.appendChild(confetti);
                
                // 动画结束后移除元素
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
            
            // 创建烟花效果
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    createFirework();
                }, i * 100);
            }
        }
        
        // 创建单个烟花
        function createFirework() {
            const x = Math.random() * window.innerWidth;
            const y = Math.random() * window.innerHeight;
            
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'firework';
                
                // 随机颜色
                const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
                particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                
                // 随机大小
                const size = Math.random() * 5 + 2;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // 动画
                particle.style.animation = `fireworks ${Math.random() * 1 + 0.5}s ease-out forwards`;
                
                document.body.appendChild(particle);
                
                // 动画结束后移除元素
                setTimeout(() => {
                    particle.remove();
                }, 1500);
            }
        }
        
        // 显示庆祝消息
        function showCelebrationMessage(message) {
            const msgElement = document.createElement('div');
            msgElement.className = 'celebration-message';
            msgElement.innerHTML = `<i class="fa fa-trophy"></i> ${message}`;
            
            document.body.appendChild(msgElement);
            
            // 触发动画
            setTimeout(() => {
                msgElement.classList.add('show');
                
                // 动画结束后移除
                setTimeout(() => {
                    msgElement.remove();
                }, 1500);
            }, 10);
        }
        
        // 设置自定义奖励模态窗口事件
        function setupCustomRewardModalEvents() {
            // 打开添加自定义奖励模态窗口
            addCustomRewardBtn.addEventListener('click', () => {
                customRewardModal.classList.add('active');
                customRewardNameInput.value = '';
                customRewardDescInput.value = '';
                customRewardCostInput.value = '';
                customRewardNameInput.focus();
            });
            
            // 关闭添加自定义奖励模态窗口
            closeCustomRewardModal.addEventListener('click', () => {
                customRewardModal.classList.remove('active');
            });
            
            // 取消添加
            cancelAddReward.addEventListener('click', () => {
                customRewardModal.classList.remove('active');
            });
            
            // 确认添加
            confirmAddReward.addEventListener('click', () => {
                const name = customRewardNameInput.value.trim();
                const desc = customRewardDescInput.value.trim();
                const cost = parseInt(customRewardCostInput.value.trim());
                
                // 验证输入
                if (!name) {
                    showNotification('请输入奖励名称', 'error');
                    return;
                }
                
                if (!desc) {
                    showNotification('请输入奖励描述', 'error');
                    return;
                }
                
                if (isNaN(cost) || cost < 10) {
                    showNotification('请输入有效的金币数量（至少10金币）', 'error');
                    return;
                }
                
                // 添加自定义奖励
                customRewards.push({
                    id: generateUniqueId(),
                    name: name,
                    description: desc,
                    cost: cost
                });
                
                // 更新界面
                renderCustomRewards();
                saveData();
                
                // 显示成功消息
                showNotification(`成功添加自定义奖励: ${name}`, 'success');
                
                // 关闭模态窗口
                customRewardModal.classList.remove('active');
            });
            
            // 点击模态窗口外部关闭
            customRewardModal.addEventListener('click', (e) => {
                if (e.target === customRewardModal) {
                    customRewardModal.classList.remove('active');
                }
            });
        }
        
        // 渲染自定义奖励
        function renderCustomRewards() {
            // 先清空所有自定义奖励（保留系统奖励）
            const customRewardCards = document.querySelectorAll('.reward-card.custom');
            customRewardCards.forEach(card => card.remove());
            
            // 添加自定义奖励
            customRewards.forEach(reward => {
                const rewardCard = document.createElement('div');
                rewardCard.className = 'reward-card custom';
                rewardCard.dataset.id = reward.id;
                
                rewardCard.innerHTML = `
                    <div class="reward-header">
                        <div class="reward-title">${reward.name}</div>
                        <div class="reward-cost">${reward.cost} 金币</div>
                    </div>
                    <div class="reward-desc">
                        ${reward.description}
                    </div>
                    <div class="flex gap-2">
                        <button class="btn btn-warning reward-btn flex-1" data-cost="${reward.cost}" data-reward="${reward.name}">
                            <i class="fa fa-shopping-cart"></i> 立即兑换
                        </button>
                        <button class="btn btn-accent delete-reward-btn" data-id="${reward.id}">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                `;
                
                // 将自定义奖励添加到奖励网格的末尾
                rewardsGrid.appendChild(rewardCard);
            });
            
            // 为新添加的奖励按钮绑定事件
            document.querySelectorAll('.reward-btn:not(.event-bound)').forEach(btn => {
                btn.classList.add('event-bound');
                btn.addEventListener('click', () => {
                    const cost = parseInt(btn.dataset.cost);
                    const reward = btn.dataset.reward;
                    redeemReward(cost, reward);
                    saveData();
                });
            });
            
            // 为删除按钮绑定事件
            document.querySelectorAll('.delete-reward-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = parseInt(btn.dataset.id);
                    deleteCustomReward(id);
                });
            });
        }
        
        // 删除自定义奖励
        function deleteCustomReward(id) {
            const index = customRewards.findIndex(reward => reward.id === id);
            if (index !== -1) {
                const rewardName = customRewards[index].name;
                customRewards.splice(index, 1);
                renderCustomRewards();
                saveData();
                showNotification(`已删除奖励: ${rewardName}`, 'success');
            }
        }
    </script>
    
    <script>
        // 确保内容不会被底部导航遮挡
        document.addEventListener('DOMContentLoaded', function() {
            const mainContent = document.querySelector('.container');
            const navHeight = document.querySelector('nav').offsetHeight;
            mainContent.style.paddingBottom = `${navHeight + 20}px`;
        });
    </script>
    
    <!-- 底部导航栏 -->
<nav class="bg-white nav-shadow py-2 px-4 fixed bottom-0 left-0 right-0 z-10">
    <div class="flex justify-around">
        <a href="index.html" class="flex flex-col items-center py-1 text-gray-500 hover:text-primary transition-colors">
            <i class="fa fa-home text-xl"></i>
            <span class="text-xs mt-1">首页</span>
        </a>
        <a href="quadrant.html" class="flex flex-col items-center py-1 text-gray-500 hover:text-primary transition-colors">
            <i class="fa fa-th text-xl"></i>
            <span class="text-xs mt-1">四象限</span>
        </a>
        <a href="todo.html" class="flex flex-col items-center py-1 text-primary">
            <i class="fa fa-check-square-o text-xl"></i>
            <span class="text-xs mt-1">待办</span>
        </a>
        <a href="more.html" class="flex flex-col items-center py-1 text-gray-500 hover:text-primary transition-colors">
            <i class="fa fa-ellipsis-h text-xl"></i>
            <span class="text-xs mt-1">更多</span>
        </a>
        <a href="guide.html" class="flex flex-col items-center py-1 text-gray-500 hover:text-primary transition-colors">
            <i class="fa fa-question-circle text-xl"></i>
            <span class="text-xs mt-1">使用指引</span>
        </a>
    </div>
</nav>
</body>
</html>
